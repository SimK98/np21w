<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<meta http-equiv="Content-Script-Type" content="text/javascript">
	<meta http-equiv="Content-Style-Type" content="text/css">
	<link rel="SHORTCUT ICON" href="../favicon.ico">
	<meta name="viewport" content="user-scalable=yes,initial-scale=1">
	<title>LGY-98 解析資料 - PC-9800 Series Emulator Neko Project 21/W</title>
	<link rel="stylesheet" type="text/css" href="../style.css?dummy=5">
</head>
<body>
	<h1>LGY-98 解析資料</h1>
	<p>
		MELCO LGY-98の解析資料です。
	</p>
	<h2>基本仕様</h2>
	<ul>
		<li>ハードウェア機能としてはNE2000互換（ポート番号は全然違う）</li>
		<li>I/Oポートのベースアドレス（以下、BASEと表記）として以下の値が選べる
			<ul>
				<li>00D0h</li>
				<li>10D0h</li>
				<li>20D0h</li>
				<li>30D0h</li>
				<li>40D0h</li>
				<li>50D0h</li>
				<li>60D0h</li>
				<li>70D0h</li>
			</ul>
		</li>
		<li>割り込みとして以下が選べる
			<ul>
				<li>INT 0</li>
				<li>INT 1</li>
				<li>INT 2</li>
				<li>INT 5</li>
			</ul>
		</li>
	</ul>
	<h2>I/Oポート</h2>
	<ul>
		<li>NE2000関連のポートについてはQEMU/9821のne2000-isa.cかNeko Project 21/Wのlgy98.cを参考に</li>
		<li>LGY-98独自のI/Oポートは恐らくBASE+300h～BASE+30Fh (IN,OUT)
			<ul>
				<li>特に重要なものは、BASE+30Ah, BASE+30Bh, BASE+30Ch, BASE+30Dh</li>
				<li>それ以外のポートでは0xffを返す？</li>
			</ul>
		</li>
		<li>MELCHKはBASE+30Ah, BASE+30Bh, BASE+30Chが期待する値かどうかでI/Oポートのベースアドレスを検出する
			<ul>
				<li>BASE+30Ahでは0x00を、BASE+30Bhでは0x40を、BASE+30Chでは0x26を返す事を期待しているらしい。値の意味は不明</li>
			</ul>
		</li>
		<li>BASE+30DhはLGY-98内蔵のROM（EEPROM？）と情報をやりとりするためのポート</li>
		<li>BASE+30Dhへ特定のシーケンスをポートに書き込むとそのシーケンスに対応するデータをポート読み取り時に返す
			<ul>
				<li>返すデータは17バイト用意され、1バイトずつ順に読み取る</li>
				<li>ポート読み取りで返される値は0x07か0x06</li>
				<li>次のバイトを要求する場合はBASE+30Dhへ0x0E→0x06の順に書き込む。
					<ul>
						<li>つまり、BASE+30DをREAD(1byte目) → BASE+30Dhへ0x0EをWRITE → BASE+30Dhへ0x06をWRITE → BASE+30DをREAD(2byte目) → BASE+30Dhへ0x0EをWRITE → ...を17バイト読み終わるまで繰り返す</li>
					</ul>
				</li>
				<li>最後のデータ（17バイト目）を読み取った後はBASE+30Dhへ0x0E→0x0Aの順に書き込むようだが詳細は不明。</li>
				<li>BASE+30Dhへ一切書き込みせずにポートを読むと常に0x0bを返す</li>
				<li>Win9xのデバイス検出はこのポートから返される値が正しくない（0x07か0x06でない）場合に「エラーはありません」とエラーメッセージを表示する</li>
				<li>BASE+30Dhへ<b>共通のシーケンス0xA,0x4,0xC,0x6,0xE,0x6,0xE,0x4を書き込んだ後</b>、それに加えて以下の表のシーケンスを送る。</li>
				<li>ほとんどのシーケンスは何を意味しているか不明だがとりあえず0x07か0x06を返しておけばエラーとはされないらしい</li>
			</ul>
		</li>
	</ul>
	<div  style="margin:16px;" class="tablediv">
	<table style="max-width:100%;font-family:monospace;" border=1>
		<thead>
			<tr><th>シーケンス</th><th>返される値</th></tr>
		</thead>
		<tbody>
			<tr><td>0xC,0x4,0xC,0x4,0xC,0x4,0xC,0x4,0xC,0x4,0xC,0x4,0xC,0x6</td><td>詳細不明</td></tr>
			<tr><td>0xC,0x4,0xC,0x4,0xC,0x4,0xC,0x4,0xC,0x4,0xC,0x6,0xE,0x6</td><td>詳細不明</td></tr>
			<tr><td>0xC,0x4,0xC,0x4,0xC,0x4,0xC,0x4,0xC,0x6,0xE,0x4,0xC,0x6</td><td>詳細不明</td></tr>
			<tr><td>0xC,0x4,0xC,0x4,0xC,0x4,0xC,0x4,0xC,0x6,0xE,0x6,0xE,0x6</td><td>詳細不明</td></tr>
			<tr><td>0xC,0x4,0xC,0x4,0xC,0x4,0xC,0x6,0xE,0x4,0xC,0x4,0xC,0x6</td><td>詳細不明</td></tr>
			<tr><td>0xC,0x4,0xC,0x4,0xC,0x4,0xC,0x6,0xE,0x4,0xC,0x6,0xE,0x6</td><td>詳細不明</td></tr>
			<tr><td>0xC,0x4,0xC,0x4,0xC,0x4,0xC,0x6,0xE,0x6,0xE,0x4,0xC,0x6</td><td>0x07の現れる位置でINTの設定値を表す（下記参照）</td></tr>
			<tr><td>0xC,0x4,0xC,0x4,0xC,0x4,0xC,0x6,0xE,0x6,0xE,0x6,0xE,0x6</td><td>詳細不明</td></tr>
			<tr><td>0xC,0x4,0xC,0x4,0xC,0x6,0xE,0x4,0xC,0x4,0xC,0x4,0xC,0x6</td><td>詳細不明</td></tr>
			<tr><td>0xC,0x4,0xC,0x4,0xC,0x6,0xE,0x4,0xC,0x4,0xC,0x6,0xE,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x4,0xC,0x4,0xC,0x6,0xE,0x4,0xC,0x6,0xE,0x4,0xC,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x4,0xC,0x4,0xC,0x6,0xE,0x4,0xC,0x6,0xE,0x6,0xE,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x4,0xC,0x4,0xC,0x6,0xE,0x6,0xE,0x4,0xC,0x4,0xC,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x4,0xC,0x4,0xC,0x6,0xE,0x6,0xE,0x4,0xC,0x6,0xE,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x4,0xC,0x4,0xC,0x6,0xE,0x6,0xE,0x6,0xE,0x4,0xC,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x4,0xC,0x4,0xC,0x6,0xE,0x6,0xE,0x6,0xE,0x6,0xE,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x4,0xC,0x6,0xE,0x4,0xC,0x4,0xC,0x4,0xC,0x4,0xC,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x4,0xC,0x6,0xE,0x4,0xC,0x4,0xC,0x4,0xC,0x6,0xE,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x4,0xC,0x6,0xE,0x4,0xC,0x4,0xC,0x6,0xE,0x4,0xC,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x4,0xC,0x6,0xE,0x4,0xC,0x4,0xC,0x6,0xE,0x6,0xE,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x4,0xC,0x6,0xE,0x4,0xC,0x6,0xE,0x4,0xC,0x4,0xC,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x4,0xC,0x6,0xE,0x4,0xC,0x6,0xE,0x4,0xC,0x6,0xE,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x4,0xC,0x6,0xE,0x4,0xC,0x6,0xE,0x6,0xE,0x4,0xC,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x4,0xC,0x6,0xE,0x4,0xC,0x6,0xE,0x6,0xE,0x6,0xE,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x4,0xC,0x6,0xE,0x6,0xE,0x4,0xC,0x4,0xC,0x4,0xC,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x4,0xC,0x6,0xE,0x6,0xE,0x4,0xC,0x4,0xC,0x6,0xE,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x4,0xC,0x6,0xE,0x6,0xE,0x4,0xC,0x6,0xE,0x4,0xC,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x4,0xC,0x6,0xE,0x6,0xE,0x4,0xC,0x6,0xE,0x6,0xE,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x4,0xC,0x6,0xE,0x6,0xE,0x6,0xE,0x4,0xC,0x4,0xC,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x4,0xC,0x6,0xE,0x6,0xE,0x6,0xE,0x4,0xC,0x6,0xE,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x4,0xC,0x6,0xE,0x6,0xE,0x6,0xE,0x6,0xE,0x4,0xC,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x4,0xC,0x6,0xE,0x6,0xE,0x6,0xE,0x6,0xE,0x6,0xE,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x6,0xE,0x4,0xC,0x4,0xC,0x4,0xC,0x4,0xC,0x4,0xC,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x6,0xE,0x4,0xC,0x4,0xC,0x4,0xC,0x4,0xC,0x6,0xE,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x6,0xE,0x4,0xC,0x4,0xC,0x4,0xC,0x6,0xE,0x4,0xC,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x6,0xE,0x4,0xC,0x4,0xC,0x4,0xC,0x6,0xE,0x6,0xE,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x6,0xE,0x4,0xC,0x4,0xC,0x6,0xE,0x4,0xC,0x4,0xC,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x6,0xE,0x4,0xC,0x4,0xC,0x6,0xE,0x4,0xC,0x6,0xE,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x6,0xE,0x4,0xC,0x4,0xC,0x6,0xE,0x6,0xE,0x4,0xC,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x6,0xE,0x4,0xC,0x4,0xC,0x6,0xE,0x6,0xE,0x6,0xE,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x6,0xE,0x4,0xC,0x6,0xE,0x4,0xC,0x4,0xC,0x4,0xC,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x6,0xE,0x4,0xC,0x6,0xE,0x4,0xC,0x4,0xC,0x6,0xE,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x6,0xE,0x4,0xC,0x6,0xE,0x4,0xC,0x6,0xE,0x4,0xC,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x6,0xE,0x4,0xC,0x6,0xE,0x4,0xC,0x6,0xE,0x6,0xE,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x6,0xE,0x4,0xC,0x6,0xE,0x6,0xE,0x4,0xC,0x4,0xC,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x6,0xE,0x4,0xC,0x6,0xE,0x6,0xE,0x4,0xC,0x6,0xE,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x6,0xE,0x4,0xC,0x6,0xE,0x6,0xE,0x6,0xE,0x4,0xC,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x6,0xE,0x4,0xC,0x6,0xE,0x6,0xE,0x6,0xE,0x6,0xE,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x6,0xE,0x6,0xE,0x4,0xC,0x4,0xC,0x4,0xC,0x4,0xC,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x6,0xE,0x6,0xE,0x4,0xC,0x4,0xC,0x4,0xC,0x6,0xE,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x6,0xE,0x6,0xE,0x4,0xC,0x4,0xC,0x6,0xE,0x4,0xC,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x6,0xE,0x6,0xE,0x4,0xC,0x4,0xC,0x6,0xE,0x6,0xE,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x6,0xE,0x6,0xE,0x4,0xC,0x6,0xE,0x4,0xC,0x4,0xC,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x6,0xE,0x6,0xE,0x4,0xC,0x6,0xE,0x4,0xC,0x6,0xE,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x6,0xE,0x6,0xE,0x4,0xC,0x6,0xE,0x6,0xE,0x4,0xC,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x6,0xE,0x6,0xE,0x4,0xC,0x6,0xE,0x6,0xE,0x6,0xE,0x6</td><td>詳細不明：最初だけ0x06、残りは0x7</td></tr>
			<tr><td>0xC,0x6,0xE,0x6,0xE,0x6,0xE,0x4,0xC,0x4,0xC,0x4,0xC,0x6</td><td>詳細不明</td></tr>
			<tr><td>0xC,0x6,0xE,0x6,0xE,0x6,0xE,0x4,0xC,0x4,0xC,0x6,0xE,0x6</td><td>詳細不明</td></tr>
			<tr><td>0xC,0x6,0xE,0x6,0xE,0x6,0xE,0x4,0xC,0x6,0xE,0x4,0xC,0x6</td><td>詳細不明</td></tr>
			<tr><td>0xC,0x6,0xE,0x6,0xE,0x6,0xE,0x4,0xC,0x6,0xE,0x6,0xE,0x6</td><td>詳細不明</td></tr>
			<tr><td>0xC,0x6,0xE,0x6,0xE,0x6,0xE,0x6,0xE,0x4,0xC,0x4,0xC,0x6</td><td>詳細不明</td></tr>
			<tr><td>0xC,0x6,0xE,0x6,0xE,0x6,0xE,0x6,0xE,0x4,0xC,0x6,0xE,0x6</td><td>詳細不明</td></tr>
			<tr><td>0xC,0x6,0xE,0x6,0xE,0x6,0xE,0x6,0xE,0x6,0xE,0x4,0xC,0x6</td><td>詳細不明</td></tr>
			<tr><td>0xC,0x6,0xE,0x6,0xE,0x6,0xE,0x6,0xE,0x6,0xE,0x6,0xE,0x6</td><td>詳細不明</td></tr>
		</tbody>
	</table>
	</div>
	<div style="margin:4px;"><small>※エミュレーションする場合、返す値が不明のポートは全て0x6を返してもエラーとはされない</small></div>
	
	<h2>シーケンス0xC,0x4,0xC,0x4,0xC,0x4,0xC,0x6,0xE,0x6,0xE,0x4,0xC,0x6の詳細</h2>
	<ul>
		<li>返される値でLGY-98のINTがいくつに設定されているかを知る事が出来る</li>
		<li>INT設定値は何回目（何バイト目）の読み取りで0x07が返るかで判断する事が出来る</li>
		<li>読み取り回数とINTの関係は以下の通り</li>
	</ul>
	<div  style="margin:16px;" class="tablediv">
	<table style="max-width:100%;" border=1>
		<thead>
			<tr><th>0x07が現れる読み取り回数</th><th>割り込み設定</th></tr>
		</thead>
		<tbody>
			<tr><td>17</td><td>INT 0</td></tr>
			<tr><td>16</td><td>INT 1</td></tr>
			<tr><td>15</td><td>INT 2</td></tr>
			<tr><td>12</td><td>INT 5</td></tr>
		</tbody>
	</table>
	</div>
	<div style="margin:4px;"><small>※例えば、6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,6,6の順で値が読み取られた場合、7が出現するのは15番目なのでINT2が設定されている。</small></div>
	<div style="margin:4px;"><small>※MELCHKでは11番目はINT6,13番目はINT4,14番目はINT3と表示されるが、実際には無効と思われる</small></div>
	
	<h2>LGY-98 DOSドライバのDMAチェック</h2>
	<ul>
		<li>DMA転送の完了チェックをコマンドレジスタbit5で行っている。これを立てないとDMAエラーと判断されて動かない。（情報提供元：http://itest.2ch.net/test/read.cgi/software/1482812256/819）</li>
	</ul>
	
	<h2>MELCHKでのMACアドレス</h2>
	<ul>
		<li>DOS用のボードチェックプログラムMELCHKはMACアドレスのベンダーIDが間違っている場合はボード異常と判断する</li>
		<li>ベンダーIDリストは調べればすぐに出てくるのでここには書きません</li>
	</ul>
	
	<p>
		<a href="../docs.html">資料集に戻る</a>
	</p>
	<p>
		<a href="../index.html">トップに戻る</a>
	</p>
</body>
</html>