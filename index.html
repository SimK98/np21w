<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="Content-Script-Type" content="text/javascript">
	<meta http-equiv="Content-Style-Type" content="text/css">
	<link rel="SHORTCUT ICON" href="./favicon.ico">
	<meta name="viewport" content="user-scalable=yes,initial-scale=1">
	<title>PC-9800 Series Emulator Neko Project 21/W</title>
	<link rel="stylesheet" type="text/css" href="./style.css?dummy=6">
	<meta name="description" content="PC-98エミュレータ Neko Project 21/WはNeko Project IIをベースに、ニッチなハードウェアのエミュレーションやPC-98後期モデルの再現に耐えうる改造を施したものです。">
	<meta property="og:type" content="website" />
	<meta property="og:url" content="https://simk98.github.io/np21w/index.html" />
	<meta property="og:title" content="PC-9800 Emulator Neko Project 21/W" />
	<meta property="og:description" content="PC-98エミュレータ Neko Project 21/WはNeko Project IIをベースに、ニッチなハードウェアのエミュレーションやPC-98後期モデルの再現に耐えうる改造を施したものです。" />
	<meta property="og:image" content="https://simk98.github.io/np21w/img/neko256_2.png" />
	<meta property="og:site_name" content="PC-9800 Series Emulator Neko Project 21/W" />
	<meta name="twitter:card" content="summary" />
	<meta name="twitter:site" content="@simk98l" />
	<meta name="twitter:title" content="PC-9800 Emulator Neko Project 21/W" />
	<meta name="twitter:description" content="PC-98エミュレータ Neko Project 21/WはNeko Project IIをベースに、ニッチなハードウェアのエミュレーションやPC-98後期モデルの再現に耐えうる改造を施したものです。" />
	<meta name="twitter:image" content="https://simk98.github.io/np21w/img/neko256_2.png" />
</head>
<body>
	<h1 style="margin:4px;">
		<img src="img/pc9821np2_emu4_21w.png" alt="PC-9800 Series Emulator Neko Project 21/W" style="display:block;">
	</h1>
	<img src="img/np21w_topimg.png" style="clear:both;display:block;">
	<div id="contents_menu" style="border: 2px solid black; padding: 8px 8px 8px 8px; margin: 8px; ">
		<h2 style="font-size:medium;">メインコンテンツ</h2>
		<ul style="padding-left: 1.3em; ">
			<li><a href="./98emulators.html">前置き</a></li>
			<li><a href="./download.html">なんかくれ</a></li>
			<li><a href="./faq.html">よくある質問</a></li>
			<li><a href="./freedos98.html">簡単な使い方</a></li>
			<li><a href="./lan.html">LAN設定</a></li>
			<li><a href="./gallery.html">ギャラリー</a></li>
			<li><a href="./docs.html">資料集</a></li>
			<li><a href="./todo.html">宿題リスト</a></li>
			<li><a href="./help/index.html">ヘルプ</a></li>
			<li><a href="./link.html">リンク集</a></li>
		</ul>
	</div>
	<div>
		<h2 style="margin-top: 0; overflow: hidden;">Neko Project 21/Wの概要</h2>
		<p style="min-width:10em;">
			Neko Project 21/W（np21w, ねこープロジェクト21/W）はPC-98エミュレータ Neko Project IIおよびNeko Project 21（ねこープロジェクトII、ねこープロジェクト21）をベースに、ニッチなハードウェアのエミュレーションやPC-98後期モデル（1993～2000頃）の再現に耐えうる改造を施したものです。
		</p>
		<ul style="overflow: hidden; margin-bottom: 0;">
			<li style="margin-top:0;line-height:150%;">後期PC-9821のハードウェアを再現</li>
			<li style="margin-top:0;line-height:150%;">Win系OSも最終のWin2000まで動作</li>
			<li style="margin-top:0;line-height:150%;">ウィンドウアクセラレータによる高解像度表示対応</li>
			<li style="margin-top:0;line-height:150%;">既存ハードウェアの改善＆追加ハードウェアへの対応(Super MPU, SB16等)</li>
			<li style="margin-top:0;line-height:150%;">UI周辺の改良</li>
			<li style="margin-top:0;line-height:150%;"><a href="#modify">その他</a></li>
		</ul>
		<div style="overflow: hidden;">
			<p style="min-width:10em;">
				また、ニッチなハードウェアのエミュレーションに限定してNeko Project II相当まで簡略化したNeko Project II/W（np2w, ねこープロジェクトII/W）も配布しています。CPUが80286（プロテクトモードなし）相当ですが、比較的軽量に動きます。
			</p>
			<p style="min-width:10em;font-weight:bold;">
				本家猫: <a href="http://www.yui.ne.jp/np2/" target="_blank">http://www.yui.ne.jp/np2/</a><br>
				Twitter: <a href="https://twitter.com/simk98l" target="_blank">https://twitter.com/simk98l</a><br>
				mail: simk98lfo@gmail.com<br>
			</p>
			<p style="min-width:10em;">
				<a href="./faq.html">問い合わせについて</a>
			</p>
		</div>
	</div>
	<div style="display:inline-block;">
		<h3 style="margin-top:0;">注意</h3>
		<p style="font-size:smaller;min-width:10em;">
			本エミュレータの機能追加の多くは98らしさが失われていった後期モデル相当ですので、開発者の腕試し的な要素が強く、一般ユーザーにはあまり役に立たないニッチなものです。
			立ち位置としては、PC-98用のゲームやソフトを動かすことよりも、PC-98アーキテクチャ自体に関心がある人へ向けたものになっています。
		</p>
		<p style="font-size:smaller;min-width:10em;">
			本家のNeko Project IIやNeko Project 21で動く物は基本的にそのまま動きますが、必ずしも本家より良くなるわけではありません。
			PC-98前期～中期（1993頃迄）のエミュレーションは例えば<a href="http://nenecchi.kirara.st/" target="_blank">Neko Project II fmgen版</a>などをおすすめします。
		</p>
	</div>
	<h2 style="clear:both;">NEWS</h2>
	<div style="margin:4px; padding: 4px; border: 3px groove gray">
		<p><pre>
【2026/01/09】
Neko Project 21/W ver0.86 rev99β1を公開しました。
・SCSIステートセーブのバグ修正
・エミュレーションIDE BIOSで異常なDA/UAが通ってしまう問題を修正
・INT 1BhでDMAバンクを跨ぐ転送がエラーになっていなかったのを修正
・rev96β3から実機IDE BIOSが使えなくなっていたのを修正
　・ただし使用は非推奨です
・実機IDE BIOS不使用時でもダミーのIDE BIOSを置くようにした
　・ダミー（実質不使用）ですのでUMB用に潰しても大丈夫なはずです

【2025/12/26】
Neko Project 21/W ver0.86 rev98を公開しました。
・バイナリが修正BSDライセンス＋fmgenライセンスになりました
　・再配布や組み込みを行った際にGPLを気にしなくてよくなります
　・ソースも標準構成ではGPLのコードを使用しなくなりました
・rev97以前のステートセーブは引き継げますがOPL3だけは互換性が少し低いです
　・rev97以前のステートセーブの場合OPL3はキーオフの状態でロードされます
・ソフトウェアキーボードをリサイズできるようになりました

【2025/12/09】
Neko Project 21/W ver0.86 rev97を公開しました。
・FDDメニューに同じディレクトリにあるFDイメージファイルの一覧を表示するようにした
　・マウントしているイメージファイルと同じ拡張子のものが表示対象です
　・マウントしていない場合は最後に開いたファイルに基づいて一覧表示されます
　・表示は最大20ファイルまでです
　・要らない場合はINIにdirfdlst=falseを書くと無効（従来通り）になります
・サウンド再生の同期が頻繁なときにSB16のサンプリング変換が狂う問題を修正
・SB16のDSP周辺コードからDOSBox由来コードを削除し新規作成
　・いちおう修正BSDライセンスとなります
　・ステートセーブ互換性維持のためデータ構造は似ていますが未使用フラグが多いです
　・動作不良も色々直っていると期待しています
・修正BSD版OPL3を追加
　・ソースのsound/mameを除外し、sound/mamebsdを使用すれば修正BSD版になります
　・古いC++の場合はsound/mamebsdsubを使用してください
　・np21/w rev97はGPL版を使用しています
・Berkeley SoftFloat Release 3を使用できるようにした
　・SUPPORT_FPU_SOFTFLOATの代わりにSUPPORT_FPU_SOFTFLOAT3を定義してください
　・この場合SoftFloatのライセンスが独自ライセンスから修正BSDに変わります
・SGDT命令の不具合修正
・動的設定変更でIRQの設定が可能になりました
　・本来ソフト的に設定を変えられないものも変更できます
　・np21wtool最新版に付属の説明を参照
・SB16の録音コマンドをダミー実装
　・SB16のDOSドライバでDMAがエラー扱いされなくなります
・ドラッグ＆ドロップ許可設定をOtherメニューに出した
・4bitしか見ないマウス向けの速度制限追加
　・マウスを速く動かすとカーソルが飛ぶソフトが正常になると思います
　・Device→Mouse→Limit Max Mouse Speedで有効化
・MIDI用スレッドの破棄タイミングを間違えていたのを修正
・FPUのステートセーブが機能していなかったのを修正

【2025/11/17】
Neko Project 21/W ver0.86 rev96を公開しました。
・十字ボタンがPOVに割り当てられているジョイパッドのためにPOV→XY軸変換設定を追加
　・Sound optionのJoyPadタブに設定があります
・エミュレーション速度を変更できるようにしました
　・メニューのEmulate→Change Emulation Speedから変更できます
・テキスト画面の1pxずれを考慮できておらず画面が切れる問題を修正
・WAB使用時に画面回転すると描画されなくなる不具合を修正
・画面拡大率に無意味な上限がある問題を修正
・FONT.ROMがないときの代替フォント生成処理を改良
　・機種依存文字の生成も可能な限り出来るようにしました
　・代替フォント名を指定できるようにしました（INIへfontfaceを追記しフォント名を設定）
　・作り直したい場合は既存のfont.tmpを一旦削除する必要があります
　・font.tmpはただのモノクロビットマップなので、拡張子変更すれば手動修正も出来ます
・フルスクリーン時のDirect3D描画が上手く行かない場合がある不具合を修正
・BCD関連のCPU命令を修正
・SoftFloat FPUの16bit整数ストア命令でエラーフラグが立たない問題を修正
・SoftFloat FPUの整数ストア命令でエラー時の値を実機に合わせた
・SoftFloat FPUのスタックオーバーフロー時にフラグが適切に立たない問題を修正
・FM音源などの再生時にタイミングが不安定になりにくくしてみました
　・Configureのマルチスレッドも有効化推奨です
・MPU MIDIのBUSYフラグの立て方が不味かったのを修正
・86PCMの挙動を色々修正してみました（変になっていたら教えて下さい）
・SCCI2に対応してみました（試せる実機を持っていませんので変だったら教えて下さい）
・fmgen有効の時に外部音源と同時に鳴ってしまう問題を修正
・実行速度改善のためのコンパイラ最適化のチューニングを実施

【2025/08/17】
Neko Project 21/W ver0.86 rev95を公開しました。
・HOSTDRV関連
　・Win32 EXEを実行するとエラーになる問題を修正
　　・HOSTDRV.COMの更新も必要です
　　・旧HOSTDRV.COMの場合np21/wは従来互換モードで動きます
　　・新HOSTDRV.COMはnp2toolとしてサイトで配布しています
　　・新HOSTDRV.COMは旧HOSTDRV.COMと互換性があります（旧np2でも従来挙動で動作）
　・ファイル属性を設定出来るようにした
　・属性とともにファイルサイズなどを返すようにした
　・属性変更時のアクセス権限ミス修正
　・ファイル検索の挙動修正
・HAXM版関連
　・レジュームを使用するとソフトリセットが効かない問題を修正
　・ウィンドウアクセラレータ描画が変になる問題を修正
　・HLT命令を実行するとフリーズする可能性がある不具合修正
　・レジューム機能を使うとリセットに失敗する不具合修正
　・フック用命令をデバッグ命令からHLT命令に変更して安定化
・SB16関連
　・MPUはMIDI設定でデバイス設定していなくても応答するようにした
　・DIAGNOSEで16bitサウンドが正常再生されない問題を修正
　・I/OポートによるDMA設定変更がレジュームで復元されない問題を修正
　・DMA周辺の修正
・WAB関連
　・WAB自動選択を使うとVRAMアクセスが変になる不具合修正
　・WABで16bitカラー以上にすると無変更でも常時描画されるようになってしまう不具合を修正
・シームレスマウス関連
　・シームレスマウス状態の時画面外へのドラッグを捕捉するように変更
　・完全シームレスマウス状態でもポーズ中はホストマウスカーソル表示するようにした
　・ウィンドウサイズが0の時ゼロ除算が起こる可能性がある問題を修正
　・ペンタブ操作と競合する問題を修正
・Neko Project 21/W 専用SCSIデバイスを実装
　・Win9x, WinNT系で使えます（ドライバはサイトにて配布）
　・DOSからは従来通り使用出来ます
　・DMA的な転送を行うので非常に高速です
　・ブートする場合PC-98のSCSI互換のCHSが必要です（特にHが15までな点に注意）
　・ブート時不具合が発生するためSCSI BIOS処理のバイパスをやめました
・その他
　・I/Oポートによるキーリピートの無効化に対応しました
　（キーリピート関連の不具合が直っているかも知れません）
　・猫CPUのSSE周辺命令修正

【2025/06/19】
Neko Project 21/W ver0.86 rev94を公開しました。
・BEEP PCMにオフセットを除去するオプションを足してみました
　・Deice->Sound->Fix beep PCM offset
　・音の鳴り始めと終わりにブツブツ音がするのが緩和されるかも知れません
・Other->CalendarのVirtual calendarの設定がリセットしたり終了したりしても保持されるようになりました
　・ホスト時刻とのオフセットが一定になるように動きます
　・仮想マシン内でカレンダを変えた場合もそのオフセットが保持されます
・CPUのかなり攻めた高速化を試みました
　・CPUクロックを適当な大きな値（例えば300MHzくらい）にしてから動的CPUクロック調整（Screen->Dynamic CPU clock adjustment）をONにすると処理時間は最速になります
・メインのビルド環境をVisual Studio 2019に変更しました
　・旧ビルド環境よりもパフォーマンスが向上します
　・ただし旧OSでは動かなくなります
　・しばらくはvs2010版も併せてリリースします
・タイミング周りの見直しで可能な限り無駄にCPU使用率を上げないようにしました
・ネットワーク周りのポーリングをやめて負荷を低減しました
・コピー＆ペースト機能でメモリ破壊していた不具合を修正しました
・SB16/118ゲームポートの有効無効を設定画面に追加しました
・SB16/118ゲームポートでアナログ入力が出来るようにしました
・Windows NT系向けのHOSTDRVを実装しました
　・Windows NT系からHOSTDRVへアクセス出来ます（ロングファイルネーム対応）
　・詳細は別途配布している「Neko Project 21/W ホスト共有ドライブドライバ＆ユーティリティ for Windows NT」を参照のこと
・np2システムポートでマウス絶対座標を取得出来るようにしました
　・Windows 3.1, NT3.51, NT4.0, 2000用のシームレスマウスドライバを試作しました
　・ドライバはnp21/wと同じ場所で配布しています
　・np2システムポートの仕様は https://simk98.github.io/np21w/docs/npcngcfg.html で公開しています
・特定のソフトウェアMIDIシンセサイザーを使用しているときCPU負荷が過剰に上がる問題の対策
　・何も送らないと異常になるようなので定期的にActive Sensingメッセージを送れるようにしました
　・INFにmidiasns=trueを書いてmidiaintに送信間隔をミリ秒で書いて下さい

【2025/04/06】
Neko Project 21/W ver0.86 rev93を公開しました。
・86PCM周りを大改修しました（ポリスノーツとかがちゃんと動きます）
・CD交換時の挙動を改善しました
・CS4231(WSS)とSB16の排他漏れを修正しました
・CS4231(WSS)のタイミングを修正しました
・CS4231(WSS)とSB16のPIO再生を修正しました
・Load VM Configでアクセス違反が発生する可能性がある問題を修正しました
・Async CPUあらため動的CPUクロック調整（Screen->Dynamic CPU clock adjustment）を実験版から正式版にしました
　・設定されているクロック数を上限として可能な限り高速に動かし、処理落ちする場合は動的にクロック数を落とします
　・PC-98系のソフトはCPUクロックが途中で変わることを想定していないと思いますので、基本は固定がよいと思います
　・np2wの方でも使えるようにしました（が、タイミングの方が重要だと思いますのでベンチマーク用ですね）
・動的CPUクロック調整使用時にタイミングがおかしくなる問題を修正しました
・マルチスレッドモード有効の時、フルスクリーン切り替え時などにたまにウィンドウが変になる問題を修正
・マルチスレッドモードを非公開機能から昇格（設定画面）に追加しました
　・Emulate→Configureの下側にあります
　・ウィンドウ操作でエミュレーションが停止しなくなり、他のアプリケーションに起因するパフォーマンスの影響を受けにくくなります
</pre></p>
		<p><a href="./history.html">更に前の更新履歴</a></p>
	</div>
	<h2 id="modify">本家からの主な変更点</h2>
	<p>
		本家から変更されている主要な部分は以下の通りです。
	</p>
	<h3>CPU／メモリ周辺</h3>
	<ul>
		<li>CPUクロック倍率制限の緩和</li>
		<li>i486DX以降のCPUを追加（実機であり得ない物も含む）</li>
		<li>CPU拡張命令の実装（FPU, MMX, SSE, 3DNow! など）</li>
		<li>大容量メモリに対応</li>
		<li>高速メモリチェック</li>
		<li>動的なCPUクロック変更</li>
		<li>エミュレーション速度変更</li>
		<li>マルチスレッド実行</li>
	</ul>
	<h3>ハードウェア（音源・MIDI）</h3>
	<ul>
		<li>fmgenの部分的サポート</li>
		<li>MAME OPL音源（118音源とSB16で使用）</li>
		<li>86音源の修正</li>
		<li>118音源の修正</li>
		<li>MIDIの修正</li>
		<li>Mate-X PCMの追加</li>
		<li>Sound Blaster 16（PCM可）の追加</li>
		<li>Super MPU（2ポート32ch MIDI）の追加</li>
		<li>Q-Vision Wave Starの追加</li>
	</ul>
	<h3>ハードウェア（グラフィック周辺・ウィンドウアクセラレータ）</h3>
	<ul>
		<li>PEGCプレーンモードの一部</li>
		<li>PC-9821内蔵 CL-GD54xx ウィンドウアクセラレータ</li>
		<li>PC-9801-96拡張ボード CL-GD54xx ウィンドウアクセラレータ</li>
		<li>MELCO WAB-S，WSN-A2F, WSN-A4F ウィンドウアクセラレータ</li>
		<li>I-O DATA GA-98NBI/C, II, IV ウィンドウアクセラレータ</li>
	</ul>
	<h3>ハードウェア（その他）</h3>
	<ul>
		<li>大容量HDDのサポート（4GB未満推奨、最大2TB）</li>
		<li>IDE 4ポート（HDD または 光学ドライブを任意に選択可）</li>
		<li>CD-DAの再生</li>
		<li>実CD/DVDイメージのマウント（EDC/ECCエミュレーション付き）</li>
		<li>PCIバス</li>
		<li>WACOMペンタブレットエミュレーション</li>
		<li>名前付きパイプでのRS-232Cエミュレーション</li>
		<li>Neko Project 21/W専用 高速SCSI（Win9x系, WinNT系ゲスト対応）</li>
		<li>HOSTDRV（ホストとファイル共有）のWinNT版</li>
		<li>完全なシームレスマウス（Win3.1, 9x系, NT系ゲスト対応）</li>
		<li>BIOS内I/Oポートアクセスエミュレーション</li>
		<li>ホスト時間からのオフセット形式での仮想カレンダ実装</li>
	</ul>
	<h3>UI周辺／その他</h3>
	<ul>
		<li>追加のディスクイメージサポート（NVL.DLLで更に追加可能）</li>
		<li>メニューにマウント中のHDDイメージを表示</li>
		<li>マウスキャプチャしないでマウス操作</li>
		<li>マウス挙動の修正、マウス速度の指定</li>
		<li>マスタボリュームの指定</li>
		<li>Direct3D描画</li>
		<li>画面の整数倍拡大、整数倍風拡大（疑似）</li>
		<li>メニューにマウント中のHDDイメージを表示</li>
		<li>メニューにFDDイメージ一覧を表示</li>
	</ul>
	<h3>バグ修正(本家ver.0.86 基準)</h3>
	<ul>
		<li>CD-ROM認識とCD-DA再生正常化</li>
		<li>IDE I/Oポートの割り込みタイミング修正</li>
		<li>HOSTDRVの不具合修正</li>
		<li>EGC周辺の修正</li>
		<li>RS-232C周辺の大幅修正</li>
		<li>DISK BIOSの修正</li>
		<li>その他色々...</li>
	</ul>
</body>
</html>