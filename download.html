<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<meta http-equiv="Content-Script-Type" content="text/javascript">
	<meta http-equiv="Content-Style-Type" content="text/css">
	<link rel="SHORTCUT ICON" href="./favicon.ico">
	<meta name="viewport" content="user-scalable=yes,initial-scale=1">
	<title>なんかくれ - PC-9800 Series Emulator Neko Project 21/W</title>
	<link rel="stylesheet" type="text/css" href="./style.css?dummy=5">
</head>
<body>
	<h1>なんかくれ</h1>
	<img src="img/pc9821np2_emu3t2_logo.png">
	<p>
		Neko Project 21/Wとその他色々を公開しています。
	</p>
	<p>
		Neko Project 21/Wは本家Neko Project 21をベースとしてPC-98中期～末期（1993年頃～）のエミュレーションも出来るように色々と機能追加したでものです。
	</p>
	<p>
		このエミュレータはWindows2000（SP4 SRP1v2必須）以降のホストでのみ実行できます。Linux等では実行できません。非Windows環境の場合はAZO氏の<a href="https://domisan.sakura.ne.jp/article/np2kai/np2kai.html" target="_blank">Neko Project II (NP2) 改変</a>を使うとほぼ同等の機能が使えます。
	</p>
	<h2>Neko Project 21/W関連</h2>
	<img src="img/np21w.png">
	<p>
		※ステートセーブ・レジュームの互換性はバージョンアップの際に無くなる場合がありますのでご注意ください<br>
		※初めて使用される場合はページ下部の注意事項もご覧下さい
	</p>
	<div class="downloadContents">
		<a href="https://drive.google.com/file/d/1NJ1fKo2UNOusULmWoKncOvsIQSAqPuiI/view?usp=drive_link">Neko Project 21/W ダウンロード（ver0.86 rev95）</a><br>
		<a href="https://drive.google.com/file/d/1hEJ-VFafu0JUyrHwCYGFOQvBJL8uNHxN/view?usp=drive_link">Neko Project 21/W ダウンロード（ver0.86 rev95）ish</a><br>
		通常版です。ソースコード付きです。
	</div>
	<div class="downloadContents">
		<a href="https://drive.google.com/file/d/1s0afs4jmpIgAbP6ErdCCY8s_lw0-KghG/view?usp=drive_link">Neko Project 21/W ダウンロード（ver0.86 rev96β5）</a><br>
		<a href="https://drive.google.com/file/d/1H82H8Xn_RmeRptroirz8k94EuR03VtQN/view?usp=drive_link">Neko Project 21/W ダウンロード（ver0.86 rev96β5）ish</a><br>
		β版です。ソースコード付きです。
	</div>
	<div class="downloadContents">
		<a href="https://drive.google.com/file/d/1OW7BPrUA9dGCOc7oTWo-NMjgRj_Uy7yt/view?usp=drive_link">Neko Project 21/W ダウンロード（ver0.86 rev94）</a><br>
		<a href="https://drive.google.com/file/d/16nYtlWxXxxwCm7yL0LbtwSD4c9Mz7bEh/view?usp=drive_link">Neko Project 21/W ダウンロード（ver0.86 rev94）ish</a><br>
		旧版です。ソースコード付きです。
	</div>
	<div class="downloadContents">
		<a href="https://drive.google.com/file/d/1R7YK4YRZXO5_-owK4if8i_U4BsjTRJpw/view?usp=sharing">Neko Project II ユーティリティディスク（np2tool.d88）</a><br>
		HOSTDRV.COM（新版）, PWOFF.COMなど<br>
	</div>
	<div class="downloadContents">
		<a href="https://drive.google.com/file/d/18KH-ZV6kCa0j0fg-4JHgSIQsiX8N6whE/view?usp=sharing">Neko Project 21/W ユーティリティ＆ディスクイメージ</a><br>
		NPCNGCLK.EXE, NPCNGCFG.EXE, NPCCxx.COMなど（本家np2/np21で使っても何も起こりません）
	</div>
	<div class="downloadContents">
		<a href="https://drive.google.com/file/d/1hWT_U6BtwzGFj2bf88xOSUBgI-kETnnA/view?usp=drive_link">Neko Project 21/W システムポートドライバ＆ユーティリティ for Windows NT (ver1.1)</a><br>
		エミュレータ内のNT系OSからNeko Project IIのシステムポートへアクセスするドライバとユーティリティです。
	</div>
	<div class="downloadContents">
		<a href="https://drive.google.com/file/d/1KMK1Sg8eZGCvOMmt1Nbq3hTQZNB_JYMH/view?usp=drive_link">Neko Project 21/W ホスト共有ドライブドライバ＆ユーティリティ for Windows NT (ver1.5)</a><br>
		エミュレータ内のNT系OSからNeko Project IIの共有ドライブ（HOSTDRV）にアクセスするドライバとユーティリティです。
	</div>
	<div class="downloadContents">
		<a href="https://drive.google.com/file/d/1MVCXBzrZv_fpe8ZSFJ0GMiYDI0rJtHqS/view?usp=drive_link">Neko Project 21/W シームレスマウスドライバ for Windows NT (ver1.1)</a><br>
		エミュレータ内のWindows NT3.51, NT4.0, 2000をシームレスにマウス操作できるようにするドライバです。
	</div>
	<div class="downloadContents">
		<a href="https://drive.google.com/file/d/1POWlAXPSO_EOqlZ2w96vW075GtxXwez4/view?usp=drive_link">Neko Project 21/W シームレスマウスドライバ for Windows 9x (ver1.0)</a><br>
		エミュレータ内のWindows 9xをシームレスにマウス操作できるようにするドライバです。
	</div>
	<div class="downloadContents">
		<a href="https://drive.google.com/file/d/1TQa4SI31_V1AI9iJxbqL-j8wuAGszD8X/view?usp=drive_link">Neko Project 21/W シームレスマウスドライバ for Windows 3.1 (ver1.0)</a><br>
		エミュレータ内のWindows 3.1をシームレスにマウス操作できるようにするドライバです。
	</div>
	<div class="downloadContents">
		<a href="https://drive.google.com/file/d/103NfD195KM9jQjN2HCYaMYYnytVeMA8F/view?usp=drive_link">Neko Project 21/W 専用SCSIドライバ for Windows (ver1.1)</a><br>
		エミュレータ内のWindows 9xおよびWindows NTで使用出来るNeko Project 21/W専用SCSIドライバです。非常に高速に読み書き出来ます。
	</div>
	<div class="downloadContents">
		<a href="https://drive.google.com/drive/folders/0B19bYGqHu2lvTWZWSHlHLWMxVW8?resourcekey=0-vfB2T2KV8fl8Y9QMFtWWoA&usp=sharing">過去バージョンのアーカイブ</a><br>
		旧バージョンのテストやdiffをしたい人向け（致命的なバグがあるバージョンも含まれます・ディスクイメージバックアップ推奨）
	</div>
	<div class="downloadContents">
		<a href="https://drive.google.com/file/d/1JSZ1eeqZ9uiELOKN738LjuQsB0S7Tpfg/view?usp=drive_link">Neko Project II用 代替フォントビットマップ</a><br>
		MS Gothicで代替フォントを自動生成出来ない環境向けのFONT.BMPです。
		実機FONT徒事の形が違いますが、ある程度使用できるようになります。
	</div>
	<div class="downloadContents">
		<a href="./develcfg.zip">参考用設定ファイル</a><br>
		開発者が使っている設定ファイルです。ほぼフルで機能を使う設定になっています。
	</div>
	<div class="downloadContents">
		<a href="http://retropc.net/yui/np2tool/index.html">GETBIOS</a><br>
		所有している実機からBIOSイメージを作成するツールです（本家ページへのリンク）。
	</div>
	<div class="downloadContents" style="font-size:smaller;">
		<a href="https://drive.google.com/file/d/1hVnCLXoO3Qs_xRGiCKx7YLAZOA9d3OK_/view?usp=sharing">各ゲストOS向けの設定ファイル</a><br>
		各OS用の推奨設定ファイルです。<del>Win2000 Setup（IDEのInterrupt DelayをRead/Writeともに2000以上にする必要あり）にさえ注意すればはあえて使う必要はないです。</del>rev.81β2からはWin2000 Setupでのディレイ設定不要です。
	</div>
	<div class="downloadContents" style="font-size:smaller;">
		<a href="https://drive.google.com/file/d/1SjKZUoMIDuom0iV44XS2ziDNWEaSm5vm/view?usp=sharing">各OSのセットアップ手順</a><br>
		各OSのセットアップ手順（旧サイトにあったもの）のアーカイブです。最近のバージョンであればこれを見ないでセットアップしてもほぼ問題ないです。
	</div>
	
	<div class="downloadContents">
	<h3>バージョン履歴</h3>
	<p>
		長いので<a href="./version.html">バージョン履歴</a>へ。
	<p>
	</div>

	<h2>実機関連</h2>
	<img src="img/sb16.png">
	<p>
		エミュレータだけでなく実機でも使えます。
	</p>
	<div class="downloadContents">
		<a href="https://drive.google.com/file/d/1MZegrFGA5fcsQ4uyvOw8EXtM97aDP15i/view?usp=sharing">Sound Blaster 16 for PC-98 Windows2000用ドライバ (WDM) パッチ ver.0.8</a><br>
		Windows2000でSound Blaster 16 for PC-98を使うためのドライバをPC/AT互換機用ドライバから生成するパッチです。実機でも使えます。旧バージョンが欲しい方は上記の過去バージョンのアーカイブから探してください。<br>
		補足：Win98で公式最新ドライバ（DirectX対応）を使いたい場合はSB16.VXDのアドレス156CEにある8B C5をEB 61に書き換えると動くそうです（どこかに書かれていた情報です）
	</div>
	<div class="downloadContents">
		<a href="https://drive.google.com/file/d/15bCvlKX3XHIpepg2ZcdDh4SUVEUJkVPr/view?usp=sharing">MPU-PC98II Windows2000用ドライバ (WDM) パッチ ver.0.8</a><br>
		Windows2000でMPU-PC98IIまたはその互換デバイスを使うためのドライバをPC/AT互換機用ドライバから生成するパッチです。実機でも使えます。安定性を求めるならNT4.0のドライバを借りてくる方が良いかもしれません。旧バージョンが欲しい方は上記の過去バージョンのアーカイブから探してください。
	</div>
	<div class="downloadContents">
		<a href="https://drive.google.com/file/d/167ymSRq-8uNjFnBXKupmmgtIRVFO4wx9/view?usp=drive_link">PC-98版 Windows NT系用 HLT命令パッチドライバ ver.1.1</a><br>
		PC-98版 Windows NT3.51, NT4.0, 2000でアイドル時にHLT命令が呼ばれないのを動的にパッチして呼ばれるようにするデバイスドライバです。
	</div>
	<div class="downloadContents" style="display:none;">
		<a href="https://drive.google.com/file/d/1E57AE5FfanQjK8zIIynrZByE_onShKkl/view?usp=drive_link">Window NT3.x用 ドライバINFインストーラ ver.1.0</a><br>
		Window NT3.xにおいて、NT4.0形式のレガシードライバINFに従ってファイルコピーとレジストリキー設定を行うものです。
		Window NT3.xでのドライバ用レジストリキーの手動設定が面倒になったので作成しました。
		真面目にINFを読み取らないので全てのNT4.0形式INFファイルをインストール出来るものではありません。
		使用する場合は、付属の説明書をよく読んで使用してください。
		また、ドライバ自体がNT3.xに対応していない場合ももちろん駄目です。
		Neko Project 21/Wのユーティリティ系ドライバのセットアップで使用しています。
		今時使う人はいないと思いますが再配布同梱等は自由にしてOKです。
	</div>
	<div class="downloadContents">
		<a href="https://drive.google.com/file/d/1cmHZMzwo-RUislEHU7CqfLwJnYyglcIh/view?usp=drive_link">Sound Blaster 16 for PC-98 WindowsNT4.0用ドライバ ver.1.2</a><br>
		WindowsNT4.0でSound Blaster 16 for PC-98を使うためのドライバです。実機でも動くそうですが作者はまだテストしていません。
	</div>
	<div class="downloadContents">
		<a href="https://drive.google.com/file/d/1rdWKD7RSvAh57sDLCpwPI5DKP6C1SSBi/view?usp=drive_link">MS-DOS及びIPLware用 SB16 for PC-98  設定変更ツール</a><br>
		Sound Blaster 16 for PC-98のIRQやDMAチャネルを一時的に変更するツールです。
		MS-DOSまたはIPLwareで実行できます。
		変更した設定はリセットで元に戻ります。
	</div>

	<h2>N88-BASIC関連</h2>
	<img src="img/fft.png">
	<p>
		N88-BASICで高速フーリエ変換をするプログラムです。
		そんなに速くない代わりに機械語なしで動きます。
	</p>
	<p>
		ほぼ下記のC言語ソースの移植ですので、私は権利主張いたしません。制限無く自由に使って頂いて構いません。<br>
		<span style="font-size:x-small;">とは言え、今更BASICで何かすることもないと思いますが･･･</span><br>
		移植元→<a href="http://www.kurims.kyoto-u.ac.jp/~ooura/fftman/" taget="_blank" rel=noreferrer>FFT (高速フーリエ・コサイン・サイン変換) の概略と設計法</a>
	</p>
	<div class="downloadContents">
		<a href="./src/FFT001.BAS">BASICで高速フーリエ変換　第1回</a><br>
		<a href="./src/FFT002.BAS">BASICで高速フーリエ変換　第2回</a><br>
		<a href="./src/FFT003.BAS">BASICで高速フーリエ変換　第3回</a><br>
		<a href="./src/FFT004.BAS">BASICで高速フーリエ変換　第4回</a><br>
		<a href="./src/FFT005.BAS">BASICで高速フーリエ変換　第5回</a><br>
		<a href="./src/FFT006.BAS">BASICで高速フーリエ変換　第6回</a><br>
		<a href="./src/FFT007.BAS">BASICで高速フーリエ変換　第7回</a><br>
		<a href="./src/FFT008.BAS">BASICで高速フーリエ変換　第8回</a><br>
		<a href="./src/FFT009.BAS">BASICで高速フーリエ変換　第9回</a><br>
	</div>

	<h2>SL9821勝手に改造関連</h2>
	<img src="img/sl9821.png">
	<p>
		SL9821にNeko Project 21/WのLGY-98とCL-GD5430を無理やりくっつけてみた試作品です。
	</p>
	<p>
		バージョンがかなり古いので注意。
	</p>
	<div class="downloadContents">
		<a href="https://drive.google.com/file/d/1SqW39FldFSygA8yWXgyrlEU0TWLZIcWK/view?usp=sharing">SL9821 + LGY-98(TAP-Win32)</a><br>
		Neko Project 21/Wのソースを流用してSL9821(0.2.4.2)をLGY-98対応させてみたものです。使用条件等はSL9821のサイトをご覧下さい。
	</div>
	<div class="downloadContents">
		<a href="https://drive.google.com/file/d/1mxQN7yfvJuCzq3yEqEXxI67YDzWl9dW6/view?usp=sharing">SL9821 + LGY-98(TAP-Win32) + CL-GD5430</a><br>
		Neko Project 21/Wのソースを流用してSL9821(0.2.4.2)をLGY-98とCL-GD5430ウィンドウアクセラレータに対応させてみたものです。別窓モードしか実装していない＆マウス操作はメイン画面でしかできないので使いにくいと思います。使用条件等はSL9821のサイトをご覧下さい。
	</div>

	<h2>注意事項</h2>
	
	<h3>BIOSについて</h3>
	<p>
		本家Neko Project IIと同じく、Neko Project 21/WもBIOSがなくてもそれなりに動くように作られています。<br>
		BIOSがない場合の制限事項は以下の通りです。<span style="font-size:smaller;">逆に言えばこれ以外の制限はほぼありません。</span>
	</p>
	<ul>
		<li>フォントが実機と異なる（FONT.ROMが無いとき）</li>
		<li>ROM版・DISK版のN88-BASICが使用できない（BIOS.ROMが無いとき）</li>
		<li>サウンドBIOSを使用するソフトが正しく動かない（SOUND.ROMが無いとき）</li>
	</ul>
	<p>
		なお、ITF.ROMは必要ありません（使用しません）。他、IDE.ROM等は非推奨のため用意する必要はありません。
	</p>
	<p>
		機種依存系のフラグは全てNeko Project 21/Wが修正しますので、よほど特殊でない限りはどんな機種から取ってきても問題ないはずです。
	</p>
	
	<h3>メモリマップについて</h3>
	<p>
		Neko Project 21/Wのメモリマップはやや特殊ですので、UMBの設定の際はご注意下さい。
		実機でチューニングしたものを持ってきてもそのままでは動かないと思います。
	</p>
	<p>
		手動で設定するのが面倒な場合はHIMEM+EMM386やLEMMにしておけば自動でそれなりに設定してくれます。
	</p>
	<div  style="margin:16px;" class="tablediv">
	<table style="max-width:100%;" border=1>
		<thead>
			<tr><th style="min-width:6em;">使用機器</th><th style="min-width:9em;">アドレス</th><th>備考</th></tr>
		</thead>
		<tbody>
			<tr><td>SASI</td><td>D0000h～D0FFFh</td><td>SASI互換HDDをIDE#0, IDE#1に接続した場合のみ使用されます</td></tr>
			<tr><td>SCSI</td><td>D2000h～D5FFFh</td><td>SCSIを使用していない場合は空きになります</td></tr>
			<tr><td>IDE</td><td>D8000h～DBFFFh</td><td>rev69以降のエミュレーションIDE BIOSでは使用されません（実機IDE BIOS使用時のみ占有）。非公開機能で変更可能（付属ヘルプ参照のこと）</td></tr>
		</tbody>
	</table>
	</div>
	
	<h3>ディスクイメージ追加サポートについて</h3>
	<p>
		NVL.DLLを用意するとNeko Project 21/Wで追加のディスクイメージが読めるようになります。NVL.DLLについては「Neko Project 21/W(np21w, ねこープロジェクト21/W)用のVirtualPC等イメージ使用ライブラリ」で検索してください（ディスクイメージエディタのNDと同じサイトです）。ページにはビルド手順が書かれていますが、現在のバージョンでは既に取り込まれていますので変更用ファイルの中のNVL.DLLだけを用意すればOKです。
	</p>
	<p>
		追加サポートされる主要なイメージ形式は以下の通りです。
	</p>
	<ul>
		<li>容量可変VirtualPC形式</li>
		<li>VMware形式</li>
		<li>Hyper-V形式</li>
		<li>VirtualBox形式</li>
		<li>QEMU qcow形式</li>
	</ul>
	
	<h3>ライセンスについて</h3>
	<p>
		Neko Project 21/Wの大半のコードは修正BSDライセンスですが、以下のファイルは移植のためライセンスが異なっています。これらを含めてコンパイルすると全体としてのライセンスが変わりますのでご注意ください。 
	</p>
	<div  style="margin:16px;" class="tablediv">
	<table style="max-width:100%;" border=1>
		<caption style="font-weight:bold;">ver0.86 rev88以降</caption>
		<thead>
			<tr><th style="min-width:6em;">ファイル</th><th style="min-width:7em;">ライセンス</th><th>除外方法</th></tr>
		</thead>
		<tbody>
			<tr><td>cirrus_vga*.*<br>lgy98*.*</td><td>MIT</td><td>SUPPORT_CL_GD5430とSUPPORT_LGY98をプリプロセッサ定義から削除する</td></tr>
			<tr><td>fpemul_dosbox.c<br>fpemul_dosbox2.c</td><td>GPL</td><td> fpemul_dosbox.c, fpemul_dosbox2.cをコンパイルから除外する</td></tr>
			<tr><td>fpemul_softfloat.c</td><td>修正BSD</td><td>SUPPORT_FPU_SOFTFLOATをプリプロセッサ定義から削除し、fpemul_softfloat.cとsoftfloat/*.*を除外する</td></tr>
			<tr><td>fpu/softfloat/*.*</td><td>Readme参照<br>修正BSD風味</td><td>SUPPORT_FPU_SOFTFLOATをプリプロセッサ定義から削除し、fpemul_softfloat.cとsoftfloat/*.*を除外する</td></tr>
			<tr><td>/sound/fmgen/*.*</td><td>Readme参照</td><td>SUPPORT_FMGENをプリプロセッサ定義から削除し、/sound/fmgen/*.*を除外する</td></tr>
			<tr><td>/sound/mame/*.*</td><td>GPLv2</td><td>USE_MAMEをプリプロセッサ定義から削除し、/sound/mame/*.*を除外する</td></tr>
		</tbody>
	</table>
	</div>
	<div  style="margin:16px;" class="tablediv">
	<table style="max-width:100%;" border=1>
		<caption style="font-weight:bold;">ver0.86 rev87以前</caption>
		<thead>
			<tr><th style="min-width:6em;">ファイル</th><th style="min-width:7em;">ライセンス</th><th>除外方法</th></tr>
		</thead>
		<tbody>
			<tr><td>cirrus_vga*.*<br>lgy98*.*</td><td>MIT</td><td>SUPPORT_CL_GD5430とSUPPORT_LGY98をプリプロセッサ定義から削除する</td></tr>
			<tr><td>fpemul_dosbox.c<br>fpemul_dosbox2.c<br>fpemul_softfloat.c</td><td>GPL</td><td> fpemul_dosbox.c, fpemul_dosbox2.c, fpemul_softfloat.cをコンパイルから除外する（Berkeley SoftFloatは本来別のライセンスですがfpemul_softfloat.cだけはDOSBox由来のコードを含むためGPLです）</td></tr>
			<tr><td>fpu/softfloat/*.*</td><td>Readme参照</td><td>SUPPORT_FPU_SOFTFLOATをプリプロセッサ定義から削除し、softfloat/*.*を除外する</td></tr>
			<tr><td>/sound/fmgen/*.*</td><td>Readme参照</td><td>SUPPORT_FMGENをプリプロセッサ定義から削除し、/sound/fmgen/*.*を除外する</td></tr>
			<tr><td>/sound/mame/*.*</td><td>GPLv2</td><td>USE_MAMEをプリプロセッサ定義から削除し、/sound/mame/*.*を除外する</td></tr>
		</tbody>
	</table>
	</div>
	
	<h3>ソースコードについて</h3>
	<p>
		Visual Studio プロジェクトはwin9x\np2vs2010.slnとwin9x\np2vs2019.slnしかメンテナンスされていません。
		また、最近のバージョンではDebugビルドもちゃんと通るようにしたつもりですが、保証はしません。
		基本的にReleaseビルドのみ可です。Debugで通したい場合はReleaseの設定値を適当に移植してください。
	</p>
	<p>
		Releaseビルドではデバッガで変数の中身を覗くことはできませんが、変数を覗きたいファイルの最適化を無効にすれば覗けるようになります。
		面倒な人はプロジェクト全体で最適化を無効にしても構いませんが、かなりパフォーマンスが落ちるので注意してください。
	</p>
	<p>
		コードにSetWindowsHookExを使ったグローバルキーフックが含まれているため、デバッガで停止中にキー入力をすると数秒フリーズします。
		これを避けたい場合はHOOK_SYSKEYをプリプロセッサ定義から削除してください。
	</p>
	
	
	<h3 id="texthook">テキストフック用の機能について</h3>
	<p>
		INIファイルの[NekoProject21]（または[NekoProjectII]）セクションにUSETHOOK=trueを追記すると、テキストフック用の機能が有効になります。
		パフォーマンスに悪影響があるので使わない時は無効にしてください。
	</p>
	<p>
		具体的には、2バイト文字を読み取る際にlstrlenW, lstrlenA, CharNextAをコールし、フックプログラムがこれをキャプチャできるようにします。
		ただし、これらの関数がコールされる場所は他にもあります。正しいフック対象の関数は実際に文字列を表示させて探してください。
	</p>
	<p>
		Textractorというソフトウェアを使用する場合は、H-codeなるものを使用しなければならないかも知れません。
	</p>
	<p>
		/HS4@0:kernel32.dll:lstrlenA<br>
		/HQ4@0:kernel32.dll:lstrlenW
	</p>
	
	<p>
		<a href="./index.html">トップに戻る</a>
	</p>
</body>
</html>